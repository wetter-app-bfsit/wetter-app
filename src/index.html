<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Calchas Wetterplattform mit Open-Meteo und BrightSky Integration - PWA mit Push-Benachrichtigungen, Favoriten, Offline-Modus"
    />
    <meta name="theme-color" content="#0b101c" />
    <link rel="manifest" href="/manifest.json" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>🌦️</text></svg>"
    />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23007BFF' width='180' height='180' rx='40'/><text x='90' y='130' font-size='140' text-anchor='middle'>🌦️</text></svg>"
    />
    <link rel="stylesheet" href="vendor/leaflet/leaflet.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,400,0,0"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="day-detail.css" />
    <link rel="stylesheet" href="mobile.css" media="(max-width: 768px)" />
    <title>Calchas - Aktuelle Wetterdaten</title>
  </head>
  <body class="mobile-app">
    <div id="app-shell" class="app-shell app-shell">
      <header id="app-bar" class="app-bar">
        <div class="app-bar__pill">
          <button
            id="location-picker-btn"
            class="app-bar__location"
            type="button"
            aria-label="Standort wählen"
            data-bottom-sheet-target="sheet-location-picker"
          >
            <span class="app-bar__location-icon material-symbols-outlined" aria-hidden="true">location_on</span>
            <div class="app-bar__location-meta">
              <span id="app-bar-location" class="app-bar__location-text">Noch kein Ort</span>
              <small id="topbar-updated" class="app-bar__updated">Keine Aktualisierung</small>
            </div>
            <span class="material-symbols-outlined app-bar__chevron" aria-hidden="true">expand_more</span>
          </button>
          <div class="app-bar__actions">
            <button
              id="favoriteToggle"
              class="icon-button app-bar__action-btn"
              type="button"
              aria-label="Zu Favoriten hinzufügen"
              data-city=""
            >
              ☆
            </button>
          </div>
        </div>
      </header>

      <main class="app-main-views" aria-label="Wetteransichten">
        <div id="error-container" class="toast-stack" aria-live="assertive"></div>
        <section data-view="home" aria-label="Heute">
          <section id="weather-hero" class="weather-hero" aria-live="polite">
            <!-- wird durch WeatherHero.js befüllt -->
          </section>

          <section class="card-group" aria-label="Einsichten und Tagesübersicht">
            <div id="insights-card" class="card card--primary"></div>
            <div id="day-summary-card" class="card"></div>
          </section>

          <section class="card-group" aria-label="Vorhersagen">
            <div id="hourly-forecast-card" class="card"></div>
            <div id="daily-forecast-card" class="card"></div>
          </section>

          <!-- Weather Cards Grid - Visual Cards wie in den Screenshots -->
          <section class="card-group card-group--grid" aria-label="Wetterdaten">
            <div id="weather-cards-grid" class="weather-cards-grid"></div>
          </section>

          <section class="card-group" aria-label="Gesundheit und Sicherheit Vorschau">
            <div id="health-preview-card" class="card"></div>
          </section>
        </section>

        <section data-view="health" id="health-section" class="app-view" hidden aria-label="Gesundheit und Sicherheit">
          <div class="app-view__header">
            <h2>🏥 Gesundheit & Sicherheit</h2>
          </div>
          <div class="app-view__content" id="health-view-container">
            <!-- Health content will be rendered here -->
          </div>
        </section>

        <section data-view="radar" hidden aria-label="Kartenansicht">
          <div class="map-view">
            <div class="map-view__header">
              <div class="map-view__title-group">
                <h2 class="map-view__title">Karten & Radar</h2>
                <p class="map-view__subtitle">Niederschlag, Wolken und Wind in deiner Umgebung.</p>
              </div>
              <button
                id="map-layer-toggle"
                class="chip-button"
                type="button"
                data-bottom-sheet-target="sheet-map-layers"
              >
                🌈 Layer
              </button>
            </div>

            <div id="map-container" class="map-container" aria-label="Wetterkarte"></div>

            <div class="map-legend-strip" aria-label="Legende der Kartendaten">
              <span class="map-legend__item"><span class="map-legend__swatch map-legend__swatch--rain"></span>Regen</span>
              <span class="map-legend__item"><span class="map-legend__swatch map-legend__swatch--snow"></span>Schnee</span>
              <span class="map-legend__item"><span class="map-legend__swatch map-legend__swatch--temp"></span>Temperatur</span>
              <span class="map-legend__item"><span class="map-legend__swatch map-legend__swatch--wind"></span>Wind</span>
              <span class="map-legend__item"><span class="map-legend__swatch map-legend__swatch--clouds"></span>Wolken</span>
              <span class="map-legend__item"><span class="map-legend__swatch map-legend__swatch--aqi"></span>AQI</span>
            </div>

            <div class="map-timeline" aria-label="Zeitverlauf der Karte">
              <button
                id="map-timeline-prev"
                class="icon-button icon-button--ghost"
                type="button"
                aria-label="Einen Schritt zurück"
              >
                ◀
              </button>
              <button
                id="map-timeline-play"
                class="icon-button icon-button--primary"
                type="button"
                aria-label="Animation abspielen oder pausieren"
              >
                ▶
              </button>
              <button
                id="map-timeline-next"
                class="icon-button icon-button--ghost"
                type="button"
                aria-label="Einen Schritt vor"
              >
                ▶
              </button>

              <input
                id="map-timeline-slider"
                class="map-timeline__slider"
                type="range"
                min="0"
                max="0"
                value="0"
                step="1"
                aria-label="Zeitschritte der Radar-Frames"
              />
              <span id="map-timeline-label" class="map-timeline__label" aria-live="polite">Live</span>
            </div>
          </div>
        </section>

        <section
          data-view="history"
          id="history-section"
          class="app-view"
          aria-label="Historische Daten"
          hidden
        >
          <div class="app-view__header">
            <h2>Wetter-Historie</h2>
          </div>
          <div class="app-view__content">
            <div id="history-container"></div>
          </div>
        </section>

        <section
          data-view="settings"
          id="settings-section"
          class="app-view"
          aria-label="Einstellungen"
          hidden
        >
          <div class="app-view__header">
            <h2>⚙️ Einstellungen</h2>
          </div>
          <div class="app-view__content">
            <div id="settings-home-container"></div>
          </div>
        </section>
      </main>

      <nav id="bottom-nav" class="bottom-nav" aria-label="Hauptnavigation">
        <button class="bottom-nav__button bottom-nav__button--active" type="button" data-nav-target="home">
          <span class="bottom-nav__icon material-symbols-outlined" aria-hidden="true">home</span>
          <span class="bottom-nav__label">Home</span>
        </button>
        <button class="bottom-nav__button" type="button" data-nav-target="radar">
          <span class="bottom-nav__icon material-symbols-outlined" aria-hidden="true">map</span>
          <span class="bottom-nav__label">Karten</span>
        </button>
        <button class="bottom-nav__button" type="button" data-nav-target="health">
          <span class="bottom-nav__icon material-symbols-outlined" aria-hidden="true">favorite</span>
          <span class="bottom-nav__label">Health</span>
        </button>
        <button class="bottom-nav__button" type="button" data-nav-target="history">
          <span class="bottom-nav__icon material-symbols-outlined" aria-hidden="true">history</span>
          <span class="bottom-nav__label">Historie</span>
        </button>
        <button class="bottom-nav__button" type="button" data-nav-target="settings">
          <span class="bottom-nav__icon material-symbols-outlined" aria-hidden="true">settings</span>
          <span class="bottom-nav__label">Settings</span>
        </button>
      </nav>

      <div class="alert-badge alert-badge--warning" style="display: none;">⚠️ 0 Warnungen aktiv</div>

      <div id="bottom-sheet-overlay" class="bottom-sheet-overlay" hidden aria-hidden="true">
        <!-- Location Picker Modal -->
        <section
          id="sheet-location-picker"
          class="bottom-sheet bottom-sheet--full"
          aria-label="Standort wählen"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon material-symbols-outlined">location_on</span>
            <div>
              <h2 class="bottom-sheet__title">Standort wählen</h2>
              <p class="bottom-sheet__subtitle">Suche oder wähle aus deinen Favoriten</p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body">
            <!-- Search Input -->
            <div class="location-search">
              <div class="location-search__input-wrapper">
                <span class="material-symbols-outlined location-search__icon">search</span>
                <input
                  type="text"
                  id="location-search-input"
                  class="location-search__input"
                  placeholder="Stadt suchen..."
                  autocomplete="off"
                />
              </div>
              <ul id="location-search-results" class="location-search__results" hidden></ul>
            </div>

            <!-- Current Location Button -->
            <button class="location-option location-option--current" type="button" id="use-current-location">
              <span class="material-symbols-outlined location-option__icon">my_location</span>
              <span class="location-option__text">Aktuellen Standort verwenden</span>
            </button>

            <!-- Favorites Section -->
            <div class="location-section">
              <h3 class="location-section__title">Favoriten</h3>
              <ul id="favorites-list" class="location-list">
                <li class="location-list__empty">Keine Favoriten gespeichert</li>
              </ul>
            </div>

            <!-- Recent Searches Section -->
            <div class="location-section">
              <h3 class="location-section__title">Zuletzt gesucht</h3>
              <ul id="recents-list" class="location-list">
                <li class="location-list__empty">Keine kürzlichen Suchen</li>
              </ul>
            </div>
          </div>
        </section>

        <section
          id="sheet-metric-wind"
          class="bottom-sheet"
          aria-label="Winddetails"
        ></section>

        <section
          id="sheet-metric-precipitation"
          class="bottom-sheet"
          aria-label="Niederschlagsdetails"
        ></section>

        <section
          id="sheet-metric-uv"
          class="bottom-sheet"
          aria-label="UV-Index Details"
        ></section>

        <section
          id="sheet-metric-visibility"
          class="bottom-sheet"
          aria-label="Sichtweitendetails"
        ></section>

        <section
          id="sheet-map-layers"
          class="bottom-sheet"
          aria-label="Kartendaten-Layer-Auswahl"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🌈</span>
            <div>
              <h2 class="bottom-sheet__title">Layer & Radar</h2>
              <p class="bottom-sheet__subtitle">Wähle, welche Daten auf der Karte angezeigt werden.</p>
            </div>
          </header>
          <div class="bottom-sheet__body">
            <div class="map-layer-group">
              <h3 class="map-layer-group__title">Niederschlag &amp; Radar</h3>
              <p class="map-layer-group__subtitle">Regen, Schnee und Radar-Animation.</p>
              <div class="map-layer-list">
                <button type="button" class="map-layer-chip" data-layer-id="radar" data-layer-group="precip">
                  <span class="map-layer-chip__icon">📡</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Radar</span>
                    <span class="map-layer-chip__subtitle">Aktuelle Radarframes der letzten Stunde.</span>
                  </span>
                </button>
                <button type="button" class="map-layer-chip" data-layer-id="rain" data-layer-group="precip">
                  <span class="map-layer-chip__icon">🌧️</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Regen</span>
                    <span class="map-layer-chip__subtitle">Flächenhafte Regenintensität.</span>
                  </span>
                </button>
                <button type="button" class="map-layer-chip" data-layer-id="snow" data-layer-group="precip">
                  <span class="map-layer-chip__icon">❄️</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Schnee</span>
                    <span class="map-layer-chip__subtitle">Schneefall und Schneeschauer.</span>
                  </span>
                </button>
              </div>
            </div>

            <div class="map-layer-group">
              <h3 class="map-layer-group__title">Temperatur &amp; Wind</h3>
              <p class="map-layer-group__subtitle">Flächentemperatur und Windfelder.</p>
              <div class="map-layer-list">
                <button type="button" class="map-layer-chip" data-layer-id="temp" data-layer-group="temp-wind">
                  <span class="map-layer-chip__icon">🌡️</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Temperaturkarte</span>
                    <span class="map-layer-chip__subtitle">Farbcodierte Lufttemperatur.</span>
                  </span>
                </button>
                <button type="button" class="map-layer-chip" data-layer-id="wind" data-layer-group="temp-wind">
                  <span class="map-layer-chip__icon">💨</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Windvektoren</span>
                    <span class="map-layer-chip__subtitle">Richtung und Stärke des Windes.</span>
                  </span>
                </button>
              </div>
            </div>

            <div class="map-layer-group">
              <h3 class="map-layer-group__title">Wolken &amp; Sicht</h3>
              <p class="map-layer-group__subtitle">Bewölkung und Sichtweite.</p>
              <div class="map-layer-list">
                <button type="button" class="map-layer-chip" data-layer-id="clouds" data-layer-group="clouds-visibility">
                  <span class="map-layer-chip__icon">☁️</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Wolken</span>
                    <span class="map-layer-chip__subtitle">Tiefe und hohe Bewölkung.</span>
                  </span>
                </button>
                <button type="button" class="map-layer-chip" data-layer-id="visibility" data-layer-group="clouds-visibility">
                  <span class="map-layer-chip__icon">🌁</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Sichtweite</span>
                    <span class="map-layer-chip__subtitle">Nebel, Dunst und Einschränkungen.</span>
                  </span>
                </button>
              </div>
            </div>

            <div class="map-layer-group">
              <h3 class="map-layer-group__title">UV &amp; Luftqualität</h3>
              <p class="map-layer-group__subtitle">Sonneneinstrahlung und Luftbelastung.</p>
              <div class="map-layer-list">
                <button type="button" class="map-layer-chip" data-layer-id="uv" data-layer-group="uv-aqi">
                  <span class="map-layer-chip__icon">☀️</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">UV-Index</span>
                    <span class="map-layer-chip__subtitle">Tagesmaximalwert und Hotspots.</span>
                  </span>
                </button>
                <button type="button" class="map-layer-chip" data-layer-id="aqi" data-layer-group="uv-aqi">
                  <span class="map-layer-chip__icon">🌫️</span>
                  <span class="map-layer-chip__text">
                    <span class="map-layer-chip__title">Luftqualität</span>
                    <span class="map-layer-chip__subtitle">EU/US-AQI mit Belastungsstufen.</span>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </section>
        <section
          id="sheet-precipitation"
          class="bottom-sheet"
          aria-label="Niederschlagsdetails"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🌧️</span>
            <div>
              <h2 class="bottom-sheet__title">Niederschlag</h2>
              <p class="bottom-sheet__subtitle">Wahrscheinlichkeit und Intensität der nächsten Stunden.</p>
            </div>
          </header>
          <div class="bottom-sheet__body"></div>
        </section>

        <section
          id="sheet-wind"
          class="bottom-sheet"
          aria-label="Winddetails"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">💨</span>
            <div>
              <h2 class="bottom-sheet__title">Wind</h2>
              <p class="bottom-sheet__subtitle">Geschwindigkeit, Böen und Verlauf.</p>
            </div>
          </header>
          <div class="bottom-sheet__body"></div>
        </section>

        <section
          id="sheet-uv"
          class="bottom-sheet"
          aria-label="UV-Details"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">☀️</span>
            <div>
              <h2 class="bottom-sheet__title">UV-Index</h2>
              <p class="bottom-sheet__subtitle">Tagesverlauf des UV-Index und Schutzempfehlungen.</p>
            </div>
          </header>
          <div class="bottom-sheet__body"></div>
        </section>

        <section
          id="sheet-aqi"
          class="bottom-sheet"
          aria-label="Luftqualitätsdetails"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🌫️</span>
            <div>
              <h2 class="bottom-sheet__title">Luftqualität</h2>
              <p class="bottom-sheet__subtitle">EU- und US-AQI mit kurzer Einordnung.</p>
            </div>
          </header>
          <div class="bottom-sheet__body"></div>
        </section>

        <section
          id="sheet-temperature-trend"
          class="bottom-sheet"
          aria-label="Temperaturverlauf"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🌡️</span>
            <div>
              <h2 class="bottom-sheet__title">Temperaturtrend</h2>
              <p class="bottom-sheet__subtitle">Kurve von Tages- und Nachttemperaturen.</p>
            </div>
          </header>
          <div class="bottom-sheet__body"></div>
        </section>

        <section
          id="sheet-sun-cloud"
          class="bottom-sheet"
          aria-label="Sonne und Wolken"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🌅</span>
            <div>
              <h2 class="bottom-sheet__title">Sonne &amp; Wolken</h2>
              <p class="bottom-sheet__subtitle">Sonnenbahn und Bewölkungsverlauf.</p>
            </div>
          </header>
          <div class="bottom-sheet__body"></div>
        </section>

        <section
          id="sheet-map-layers"
          class="bottom-sheet"
          aria-label="Kartenschichten auswählen"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🗺️</span>
            <div>
              <h2 class="bottom-sheet__title">Kartenschichten</h2>
              <p class="bottom-sheet__subtitle">
                Wähle, welche Wetterlayer auf der Karte sichtbar sind.
              </p>
            </div>
          </header>
          <div id="map-layer-list" class="bottom-sheet__body"></div>
        </section>

        <!-- Settings Sheets (inside overlay so they only show when triggered) -->
        <section
          id="sheet-settings-theme"
          class="bottom-sheet"
          aria-label="Erscheinungsbild wählen"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🎨</span>
            <div>
              <h2 class="bottom-sheet__title">Aussehen</h2>
              <p class="bottom-sheet__subtitle">
                Themen, Animationen und App-Layout.
              </p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-theme-body"></div>
        </section>

        <section
          id="sheet-settings-home"
          class="bottom-sheet"
          aria-label="Heimatort verwalten"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">📍</span>
            <div>
              <h2 class="bottom-sheet__title">Heimatort</h2>
              <p class="bottom-sheet__subtitle">
                Heimatort und Favoriten verwalten.
              </p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-home-body"></div>
        </section>

        <section
          id="sheet-settings-privacy"
          class="bottom-sheet"
          aria-label="Datenschutz &amp; APIs"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🔒</span>
            <div>
              <h2 class="bottom-sheet__title">Datenschutz &amp; APIs</h2>
              <p class="bottom-sheet__subtitle">
                Wie deine Daten gespeichert werden und welche Dienste genutzt werden.
              </p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-privacy-body"></div>
        </section>

        <section
          id="sheet-settings-units"
          class="bottom-sheet"
          aria-label="Einheiten anpassen"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">📏</span>
            <div>
              <h2 class="bottom-sheet__title">Einheiten</h2>
              <p class="bottom-sheet__subtitle">
                Temperatur, Wind, Druck und mehr.
              </p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-units-body"></div>
        </section>

        <section
          id="sheet-settings-language"
          class="bottom-sheet"
          aria-label="Sprache wählen"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🌐</span>
            <div>
              <h2 class="bottom-sheet__title">Sprache</h2>
              <p class="bottom-sheet__subtitle">
                App-Sprache und Datumsformate.
              </p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-language-body"></div>
        </section>

        <section
          id="sheet-settings-about"
          class="bottom-sheet"
          aria-label="Über Calchas"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">ℹ️</span>
            <div>
              <h2 class="bottom-sheet__title">Über Calchas</h2>
              <p class="bottom-sheet__subtitle">
                Version, Lizenzen und Datenschutzhinweise.
              </p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-about-body"></div>
        </section>

        <!-- Additional Settings Sheets -->
        <section
          id="sheet-settings-background"
          class="bottom-sheet"
          aria-label="Hintergrundaktualisierungen"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🔄</span>
            <div>
              <h2 class="bottom-sheet__title">Hintergrundaktualisierungen</h2>
              <p class="bottom-sheet__subtitle">Widget-Updates und geplante Aktualisierungen.</p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-background-body">
            <p style="padding: 20px; color: rgba(255,255,255,0.6); text-align: center;">
              Hintergrundaktualisierungen sind in dieser Version noch nicht verfügbar.
            </p>
          </div>
        </section>

        <section
          id="sheet-settings-models"
          class="bottom-sheet"
          aria-label="Wettermodelle"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">☁️</span>
            <div>
              <h2 class="bottom-sheet__title">Wettermodelle</h2>
              <p class="bottom-sheet__subtitle">Open-Meteo Wettermodelle auswählen.</p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-models-body">
            <div class="settings-placeholder">
              <p class="settings-placeholder__title">Bald verfügbar</p>
              <p class="settings-placeholder__text">
                Die Auswahl zwischen Open-Meteo Modellen befindet sich in Arbeit. Aktuell wird das Standardmodell genutzt.
              </p>
            </div>
          </div>
        </section>

        <section
          id="sheet-settings-export"
          class="bottom-sheet"
          aria-label="Daten exportieren"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">📤</span>
            <div>
              <h2 class="bottom-sheet__title">Daten exportieren</h2>
              <p class="bottom-sheet__subtitle">Einstellungen und Favoriten exportieren.</p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-export-body">
            <div class="settings-placeholder">
              <p class="settings-placeholder__title">Bald verfügbar</p>
              <p class="settings-placeholder__text">
                Sichere deine Favoriten und Einstellungen als Datei. Wir arbeiten an einem DSGVO-konformen Export.
              </p>
            </div>
          </div>
        </section>

        <section
          id="sheet-settings-import"
          class="bottom-sheet"
          aria-label="Daten importieren"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">📥</span>
            <div>
              <h2 class="bottom-sheet__title">Daten importieren</h2>
              <p class="bottom-sheet__subtitle">Einstellungen und Favoriten importieren.</p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-import-body">
            <div class="settings-placeholder">
              <p class="settings-placeholder__title">Bald verfügbar</p>
              <p class="settings-placeholder__text">
                Spiele gesicherte Daten wieder ein und synchronisiere mehrere Geräte. Coming soon.
              </p>
            </div>
          </div>
        </section>

        <section
          id="sheet-settings-discord"
          class="bottom-sheet"
          aria-label="Discord"
        >
          <header class="bottom-sheet__header">
            <span class="bottom-sheet__icon">🎮</span>
            <div>
              <h2 class="bottom-sheet__title">Discord Community</h2>
              <p class="bottom-sheet__subtitle">Tritt unserer Community bei!</p>
            </div>
            <button class="bottom-sheet__close" type="button" data-close-sheet aria-label="Schließen">
              <span class="material-symbols-outlined">close</span>
            </button>
          </header>
          <div class="bottom-sheet__body" id="settings-discord-body">
            <div style="padding: 20px; text-align: center;">
              <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
                Werde Teil unserer Discord-Community und tausche dich mit anderen Wetter-Enthusiasten aus!
              </p>
              <a href="https://discord.gg/weathermaster" target="_blank"
                 style="display: inline-block; padding: 14px 28px; background: #5865f2; color: white;
                        border-radius: 12px; text-decoration: none; font-weight: 500;">
                Discord beitreten
              </a>
            </div>
          </div>
        </section>

        <section
          id="sheet-map-alerts"
          class="bottom-sheet"
          aria-label="Wetter-Warnungen"
        >
          <div class="bottom-sheet__header">
            <span class="bottom-sheet__icon">⚠️</span>
            <span class="bottom-sheet__title">Aktive Warnungen</span>
            <span class="bottom-sheet__subtitle" id="alert-count"
              >0 Warnungen</span
            >
          </div>
          <div class="bottom-sheet__body">
            <div id="alert-list" class="alert-list"></div>
          </div>
        </section>
      </div>

      <div id="legacy-content" hidden>
          <div class="app-sky" aria-hidden="true"></div>
          <header class="app-topbar" role="banner">
        <button
          id="settingsBtn"
          class="icon-btn ghost"
          type="button"
          aria-label="Einstellungen öffnen"
        >
          ⚙️
        </button>
        <div class="topbar-location">
          <p id="topbar-location-name">Noch kein Ort</p>
          <small id="topbar-updated">Keine Aktualisierung</small>
        </div>
        <div class="topbar-actions">
          <button
            id="searchFocusBtn"
            class="icon-btn ghost"
            type="button"
            aria-label="Suche fokussieren"
          >
            🔍
          </button>
          <button
            id="favoriteToggle"
            class="icon-btn ghost"
            type="button"
            aria-label="Zu Favoriten hinzufügen"
            data-city=""
          >
            ☆
          </button>
        </div>
      </header>

      <main class="app-main" role="main" id="legacy-content">
        <div
          id="error-container"
          class="toast-stack"
          aria-live="assertive"
        ></div>

        <section
          class="card-section search-hub"
          id="search-hub"
          aria-labelledby="search-title"
        >
          <div class="search-hub-headline">
            <div>
              <p class="eyebrow">Schnellsuche</p>
              <h1 id="search-title">Direkt zum passenden Ort</h1>
              <p class="helper-text">
                Nutze die globale Suche, setze deinen Heimatort und verwalte
                Favoriten für den schnellen Zugriff.
              </p>
            </div>
            <div class="search-hub-actions">
              <button id="use-home-btn" class="btn-ghost" type="button">
                Heimat laden
              </button>
            </div>
          </div>
          <div class="search-input-group">
            <label class="sr-only" for="cityInput">Ort suchen</label>
            <input
              id="cityInput"
              type="search"
              placeholder="Berlin, Hamburg, Zürich..."
              autocomplete="off"
            />
            <button id="searchBtn" type="button" class="btn-primary">
              Suche
            </button>
          </div>
          <div class="search-meta-grid">
            <div class="recent-panel surface-card">
              <div class="panel-headline">
                <p class="eyebrow">Zuletzt gesucht</p>
                <button id="clear-recent-btn" type="button" class="btn-link">
                  Verlauf löschen
                </button>
              </div>
              <div
                id="recent-cities"
                class="recents-grid"
                role="list"
                aria-live="polite"
              ></div>
            </div>
            <div class="favorites-card surface-card">
              <div class="panel-headline">
                <p class="eyebrow">Favoriten</p>
                <span>Ziehe zum Sortieren</span>
              </div>
              <div class="favorites-list" role="list"></div>
            </div>
          </div>
        </section>

        <section class="grid hero-grid" aria-label="Aktuelle Wetterlage">
          <article
            id="current-weather"
            class="surface-card hero-card"
            aria-live="polite"
          >
            <div class="placeholder-state">
              <p>🔎 Suche nach einem Ort, um Live-Wetter zu sehen.</p>
            </div>
          </article>
          <article class="surface-card overview-card" aria-live="polite">
            <div id="daily-overview" class="overview-slot">
              <div class="placeholder-state">
                <p>🧠 Tagesübersicht erscheint nach der ersten Ortssuche.</p>
              </div>
            </div>
          </article>
        </section>

        <section class="grid detail-grid" aria-label="Vertiefende Einsichten">
          <article class="surface-card" aria-live="polite">
            <div id="climate-panels" class="insights-slot">
              <div class="placeholder-state">
                <p>Messwerte wie Luftfeuchte, UV und Wind folgen nach Abruf.</p>
              </div>
            </div>
          </article>
          <article class="surface-card" aria-live="polite">
            <div id="daily-insights" class="insights-slot">
              <div class="placeholder-state">
                <p>📈 Tagesinsights werden nach Datenabruf erstellt.</p>
              </div>
            </div>
          </article>
        </section>

        <section
          class="surface-card forecast-card"
          aria-labelledby="forecast-heading"
        >
          <div class="section-headline">
            <div>
              <p class="eyebrow">Prognose</p>
              <h2 id="forecast-heading">Mehr-Tage Verlauf</h2>
            </div>
            <button
              class="btn-tertiary"
              type="button"
              onclick="openSettingsModal()"
            >
              ⚙️ Einstellungen
            </button>
          </div>
          <div
            id="forecast-container"
            class="forecast-shell"
            aria-live="polite"
          ></div>
        </section>

        <section
          class="surface-card hourly-card"
          aria-labelledby="hourly-heading"
        >
          <div class="section-headline">
            <div>
              <p class="eyebrow">Timeline</p>
              <h2 id="hourly-heading">Nächste Stunden</h2>
            </div>
          </div>
          <div
            id="hourly-section"
            class="hourly-shell"
            aria-live="polite"
          ></div>
        </section>

        <section class="grid map-alerts-grid" aria-label="Radar und Warnungen">
          <article class="surface-card map-panel">
            <div class="section-headline">
              <div>
                <p class="eyebrow">Radar & Layers</p>
                <h2>Kartenansicht</h2>
              </div>
              <div
                id="map-layer-context"
                class="map-layer-context"
                data-placeholder="Aktive Layer werden nach dem Laden angezeigt"
              ></div>
            </div>
            <div class="map-body">
              <div
                id="weather-map"
                class="weather-map"
                data-placeholder="Karte wird nach der ersten Ortssuche aktiviert"
                role="img"
                aria-label="Interaktive Wetterkarte"
              ></div>
              <div class="map-controls-grid">
                <div
                  id="map-radar-controls"
                  class="map-radar-controls"
                  data-placeholder="Radar-Layer &amp; Zeitleiste erscheinen hier"
                ></div>
                <div
                  id="map-quick-actions"
                  class="map-quick-actions"
                  data-placeholder="Schnellaktionen folgen nach dem Laden"
                ></div>
                <div
                  id="map-overlay-legend"
                  class="map-overlay-legend"
                  data-placeholder="Legende der aktiven Overlays"
                ></div>
              </div>
            </div>
            <div
              id="map-inspector"
              class="map-inspector"
              data-placeholder="Fahre über die Karte, um Live-Daten je Ort zu sehen"
              aria-live="polite"
            ></div>
          </article>
          <article
            class="surface-card alerts-panel"
            aria-labelledby="alerts-heading"
          >
            <div class="section-headline">
              <div>
                <p class="eyebrow">Warnmeldungen</p>
                <h2 id="alerts-heading">MeteoAlarm</h2>
              </div>
            </div>
            <div id="weather-alerts" aria-live="polite"></div>
          </article>
        </section>

        <section
          class="grid history-analytics-grid"
          aria-label="Historie und Nutzung"
        >
          <article
            class="surface-card historical-panel"
            aria-labelledby="history-heading"
          >
            <div class="section-headline">
              <div>
                <p class="eyebrow">Rückblick</p>
                <h2 id="history-heading">Historische Daten</h2>
              </div>
            </div>
            <div id="historical-chart" class="historical-shell"></div>
          </article>
          <article
            class="surface-card analytics-panel-container"
            aria-labelledby="analytics-heading"
          >
            <div class="section-headline">
              <div>
                <p class="eyebrow">Nutzungsdaten</p>
                <h2 id="analytics-heading">Analytics</h2>
              </div>
            </div>
            <div id="analytics-panel" class="analytics-shell"></div>
          </article>
        </section>

        <section class="card-section info-card" aria-labelledby="info-heading">
          <div class="card-headline">
            <p class="eyebrow">Datenschutz</p>
            <h2 id="info-heading">Deine Daten gehören dir</h2>
          </div>
          <p>
            Standort, Suchverlauf und Favoriten bleiben lokal auf deinem Gerät.
            Optional gespeicherte API-Keys und Push-Zertifikate verlassen
            niemals deinen Browser.
          </p>
          <p>
            Weitere Details findest du in den verlinkten Legal-Dokumenten im
            Footer oder im Einstellungsdialog.
          </p>
        </section>
      </main>

      <footer class="app-footer" role="contentinfo">
        <p class="footer-text">
          🌐 Datenquellen:
          <a
            href="https://open-meteo.com"
            target="_blank"
            rel="noopener noreferrer"
            >Open-Meteo</a
          >
          |
          <a
            href="https://brightsky.dev"
            target="_blank"
            rel="noopener noreferrer"
            >BrightSky</a
          >
          |
          <a
            href="https://nominatim.org"
            target="_blank"
            rel="noopener noreferrer"
            >Nominatim</a
          >
        </p>
        <p class="footer-text">
          <small>
            © 2025 Calchas |
            <a
              href="../legal/privacy.html"
              target="_blank"
              rel="noopener noreferrer"
              >Datenschutz</a
            >
            |
            <a
              href="../legal/terms.html"
              target="_blank"
              rel="noopener noreferrer"
              >Nutzungsbedingungen</a
            >
          </small>
        </p>
      </footer>
    </div>

    <!-- Settings Modal -->
    <div
      id="settings-modal"
      class="modal"
      role="dialog"
      aria-labelledby="settings-title"
      aria-hidden="true"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="settings-title">Einstellungen</h2>
          <button
            class="modal-close"
            data-close="settings-modal"
            aria-label="Einstellungsfenster schließen"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p class="settings-lead">
            Kompakte Übersicht über alle Feinjustierungen, Quellen und
            Integrationen. Alles Wichtige bleibt hier gebündelt.
          </p>
          <div class="settings-panel" role="list">
            <section class="settings-section">
              <p class="settings-section-label">Allgemein</p>
              <div
                class="settings-list"
                role="group"
                aria-label="Allgemeine Einstellungen"
              >
                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="sun"
                  data-settings-target="appearance"
                >
                  <div class="settings-row-icon" aria-hidden="true">🎨</div>
                  <div class="settings-row-body">
                    <h3>Aussehen</h3>
                    <p>Themen, Animationen und App-Layout.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="leaf"
                  data-settings-target="home"
                >
                  <div class="settings-row-icon" aria-hidden="true">🏠</div>
                  <div class="settings-row-body">
                    <h3>Heimatort</h3>
                    <p>
                      Standard-Ort zum Start der App.
                      <strong id="home-location-label">Nicht gesetzt</strong>
                    </p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="marine"
                  data-settings-target="units"
                >
                  <div class="settings-row-icon" aria-hidden="true">📏</div>
                  <div class="settings-row-body">
                    <h3>Einheiten</h3>
                    <p>Temperatur, Wind und Luftdruck für alle Panels.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="ember"
                  data-settings-target="background"
                >
                  <div class="settings-row-icon" aria-hidden="true">🔄</div>
                  <div class="settings-row-body">
                    <h3>Hintergrundaktualisierungen</h3>
                    <p>Widget-Updates, Intervalle und geplante Pulls.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="teal"
                  data-settings-target="models"
                >
                  <div class="settings-row-icon" aria-hidden="true">☁️</div>
                  <div class="settings-row-body">
                    <h3>Wettermodelle</h3>
                    <p>Open-Meteo Wettermodelle sind aktiv.</p>
                    <span class="settings-chip">Open-Meteo</span>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>
              </div>
            </section>

            <section class="settings-section">
              <p class="settings-section-label">Sprache &amp; Daten</p>
              <div
                class="settings-list"
                role="group"
                aria-label="Sprache und Daten"
              >
                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="plum"
                  data-settings-target="locale"
                >
                  <div class="settings-row-icon" aria-hidden="true">🌐</div>
                  <div class="settings-row-body">
                    <h3>Sprache &amp; Speicher</h3>
                    <p>UI-Sprache wählen, Cache und Verlauf pflegen.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="amber"
                  data-settings-target="export"
                >
                  <div class="settings-row-icon" aria-hidden="true">📤</div>
                  <div class="settings-row-body">
                    <h3>Daten exportieren</h3>
                    <p>Analytics-Ereignisse als JSON sichern.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="amber"
                  data-settings-target="import"
                >
                  <div class="settings-row-icon" aria-hidden="true">📥</div>
                  <div class="settings-row-body">
                    <h3>Daten importieren</h3>
                    <p>Vorher exportierte Nutzungsdaten wiederherstellen.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>
              </div>
            </section>

            <section class="settings-section">
              <p class="settings-section-label">Community &amp; Info</p>
              <div
                class="settings-list"
                role="group"
                aria-label="Community und Informationen"
              >
                <a
                  class="settings-row external-link"
                  data-accent="indigo"
                  href="https://discord.gg/calchas"
                  target="_blank"
                  rel="noreferrer noopener"
                >
                  <div class="settings-row-icon" aria-hidden="true">💬</div>
                  <div class="settings-row-body">
                    <h3>Tritt unserem Discord Server bei</h3>
                    <p>Austausch, Release-Notes und Feature-Feedback.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">↗</span>
                </a>

                <a
                  class="settings-row external-link"
                  data-accent="violet"
                  href="../docs/README.md"
                  target="_blank"
                  rel="noreferrer noopener"
                >
                  <div class="settings-row-icon" aria-hidden="true">ℹ️</div>
                  <div class="settings-row-body">
                    <h3>Über Calchas</h3>
                    <p>Änderungsprotokoll, Version, Lizenzen und mehr.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">↗</span>
                </a>
              </div>
            </section>

            <details class="settings-advanced">
              <summary>
                <span>Expertenbereich &amp; Integrationen</span>
                <span aria-hidden="true">▼</span>
              </summary>
              <div
                class="settings-list"
                role="group"
                aria-label="Experteneinstellungen"
              >
                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="ember"
                  data-settings-target="push"
                >
                  <div class="settings-row-icon" aria-hidden="true">🔔</div>
                  <div class="settings-row-body">
                    <h3>Push-Benachrichtigungen</h3>
                    <p>
                      VAPID-Key hinterlegen, um lokale Push-Dienste zu nutzen.
                    </p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="teal"
                  data-settings-target="api-keys"
                >
                  <div class="settings-row-icon" aria-hidden="true">🔑</div>
                  <div class="settings-row-body">
                    <h3>APIs &amp; Integrationen</h3>
                    <p>
                      Optionale Schlüssel bleiben ausschließlich lokal
                      gespeichert.
                    </p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="cyan"
                  data-settings-target="status"
                >
                  <div class="settings-row-icon" aria-hidden="true">📊</div>
                  <div class="settings-row-body">
                    <h3>Status &amp; Quellen</h3>
                    <p>
                      Behalte im Blick, welche Provider aktiv oder optional
                      sind.
                    </p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="pink"
                  data-settings-target="comparison"
                >
                  <div class="settings-row-icon" aria-hidden="true">⚖️</div>
                  <div class="settings-row-body">
                    <h3>API Vergleiche</h3>
                    <p>
                      Open-Meteo und BrightSky im direkten Vergleich inkl.
                      Abweichungen.
                    </p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>

                <article
                  class="settings-row settings-link"
                  role="button"
                  tabindex="0"
                  data-accent="slate"
                  data-settings-target="docs"
                >
                  <div class="settings-row-icon" aria-hidden="true">📄</div>
                  <div class="settings-row-body">
                    <h3>Technische Dokumentation</h3>
                    <p>Architektur, Teststatus und regulatorische Notizen.</p>
                  </div>
                  <span class="settings-row-chevron" aria-hidden="true">›</span>
                </article>
              </div>
            </details>
          </div>
          <div
            id="settings-subview-overlay"
            class="settings-subview-overlay"
            aria-hidden="true"
          >
            <div class="settings-subview-layer" role="document">
              <section
                class="settings-subview"
                data-view="appearance"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                    aria-label="Zurück zu den Einstellungen"
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Darstellung</p>
                    <h3>Aussehen</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <p>
                    Wähle, ob Calchas automatisch dem Systemthema folgen oder
                    dauerhaft im Dark Mode bleiben soll.
                  </p>
                  <label class="dark-mode-switch" aria-label="Dark Mode">
                    <span class="switch-label">Dark Mode aktivieren</span>
                    <input type="checkbox" id="darkModeToggle" />
                    <span class="dark-mode-slider"></span>
                  </label>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="home"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Favoriten</p>
                    <h3>Heimatort</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <p>
                    Lege einen Ort fest, der beim Start sofort geladen wird. Du
                    kannst ihn jederzeit entfernen.
                  </p>
                  <div class="settings-quick-actions">
                    <button id="set-home-btn" class="btn-primary" type="button">
                      Aktuellen Ort speichern
                    </button>
                    <button id="clear-home-btn" class="btn-link" type="button">
                      Entfernen
                    </button>
                  </div>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="units"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Formatierung</p>
                    <h3>Einheiten</h3>
                  </div>
                </header>
                <div class="settings-subview-body tile-form">
                  <label class="tile-field">
                    <span>Temperatur</span>
                    <select id="temp-unit-select" class="settings-select">
                      <option value="C">Celsius (°C)</option>
                      <option value="F">Fahrenheit (°F)</option>
                    </select>
                  </label>
                  <label class="tile-field">
                    <span>Wind</span>
                    <select id="wind-unit-select" class="settings-select">
                      <option value="km/h">Kilometer pro Stunde (km/h)</option>
                      <option value="m/s">Meter pro Sekunde (m/s)</option>
                      <option value="mph">Meilen pro Stunde (mph)</option>
                    </select>
                  </label>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="background"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Automatisierung</p>
                    <h3>Hintergrundaktualisierung</h3>
                  </div>
                </header>
                <div class="settings-subview-body tile-form">
                  <label class="tile-field">
                    <span>Intervall</span>
                    <select
                      id="background-refresh-select"
                      class="settings-select"
                    >
                      <option value="off">Nur manuell</option>
                      <option value="30">Alle 30 Minuten</option>
                      <option value="60">Stündlich</option>
                    </select>
                  </label>
                  <p class="settings-helper">
                    Hintergrundaktualisierungen werden nur ausgeführt, wenn du
                    Push-Benachrichtigungen erlaubt hast und die App geöffnet
                    war.
                  </p>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="models"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Datenbasis</p>
                    <h3>Wettermodelle</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <p>
                    Calchas nutzt standardmäßig Open-Meteo als Multi-Model
                    Provider. Zusätzliche Provider können in Zukunft ergänzt
                    werden.
                  </p>
                  <div class="model-chip-grid">
                    <span class="settings-chip">Open-Meteo</span>
                    <span class="settings-chip">BrightSky</span>
                    <span class="settings-chip">VisualCrossing</span>
                  </div>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="locale"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Sprache &amp; Speicher</p>
                    <h3>Lokalisierung</h3>
                  </div>
                </header>
                <div class="settings-subview-body tile-form">
                  <label class="tile-field">
                    <span>Sprache</span>
                    <select id="lang-select" class="settings-select">
                      <option value="de">Deutsch</option>
                      <option value="en">English</option>
                    </select>
                  </label>
                  <label class="settings-toggle">
                    <input
                      type="checkbox"
                      id="cache-enabled"
                      checked
                      aria-label="Daten-Caching aktivieren"
                    />
                    <span>Cache aktiv</span>
                  </label>
                  <button
                    id="clear-cache-btn"
                    class="btn-secondary"
                    type="button"
                    aria-label="Gecachte Wetterdaten löschen"
                  >
                    Cache leeren
                  </button>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="export"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Backup</p>
                    <h3>Daten exportieren</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <p>Sichere deine Analytics- und App-Daten als JSON-Datei.</p>
                  <button
                    id="settings-export-data"
                    class="btn-primary"
                    type="button"
                  >
                    JSON exportieren
                  </button>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="import"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Backup</p>
                    <h3>Daten importieren</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <p>Spiele zuvor exportierte Calchas-Daten wieder ein.</p>
                  <button
                    id="settings-import-data"
                    class="btn-secondary"
                    type="button"
                  >
                    JSON wählen
                  </button>
                  <input
                    id="settings-import-file"
                    type="file"
                    accept="application/json"
                    hidden
                    aria-hidden="true"
                  />
                  <p class="settings-helper">
                    Unterstützt Calchas-Exporte (*.json) direkt aus der App.
                  </p>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="push"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Expertenbereich</p>
                    <h3>Push-Benachrichtigungen</h3>
                  </div>
                </header>
                <div class="settings-subview-body tile-form">
                  <div class="settings-quick-actions">
                    <button
                      id="pushToggle"
                      class="btn-secondary"
                      type="button"
                      aria-pressed="false"
                    >
                      🔔 Push aktivieren
                    </button>
                  </div>
                  <label class="tile-field">
                    <span>VAPID Public Key</span>
                    <input
                      id="vapidKeyInput"
                      class="settings-input"
                      placeholder="Base64 URL-safe Public VAPID Key"
                      aria-describedby="vapid-help"
                    />
                  </label>
                  <p id="vapid-help" class="settings-helper">
                    Vom lokalen Push-Server abrufbar oder manuell eintragen.
                  </p>
                  <div class="settings-quick-actions">
                    <button
                      id="saveVapidBtn"
                      class="btn-secondary"
                      type="button"
                    >
                      Speichern
                    </button>
                    <button
                      id="fetchVapidBtn"
                      class="btn-secondary"
                      type="button"
                    >
                      Fetch VAPID
                    </button>
                  </div>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="api-keys"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Integrationen</p>
                    <h3>APIs &amp; Keys</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <div
                    id="api-keys-container"
                    class="settings-input-grid"
                    role="group"
                    aria-label="Optionale API-Keys"
                  >
                    <label for="openweathermap-key">
                      OpenWeatherMap Key
                      <input
                        id="openweathermap-key"
                        class="settings-input"
                        placeholder="OpenWeatherMap API Key"
                        aria-label="OpenWeatherMap API Key"
                        type="password"
                      />
                      <small class="settings-helper"
                        >Persönlicher One Call 3.0 Key erforderlich. Hilfe im
                        <a
                          href="../docs/api/API_ACCOUNTS.md#5-openweathermap-optional"
                          target="_blank"
                          rel="noreferrer noopener"
                          >API Guide</a
                        >.
                      </small>
                    </label>
                    <label for="visualcrossing-key">
                      VisualCrossing Key
                      <input
                        id="visualcrossing-key"
                        class="settings-input"
                        placeholder="VisualCrossing API Key"
                        aria-label="VisualCrossing API Key"
                        type="password"
                      />
                    </label>
                    <label for="meteostat-key">
                      Meteostat Key
                      <input
                        id="meteostat-key"
                        class="settings-input"
                        placeholder="Meteostat API Key"
                        aria-label="Meteostat API Key"
                        type="password"
                      />
                    </label>
                  </div>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="status"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Monitoring</p>
                    <h3>Status &amp; Quellen</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <div
                    id="api-status"
                    class="api-status-list"
                    role="region"
                    aria-label="Status der Wetterdatenquellen"
                    aria-live="polite"
                  ></div>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="comparison"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Quellenvergleich</p>
                    <h3>API Vergleiche</h3>
                  </div>
                </header>
                <div class="settings-subview-body">
                  <div
                    id="settings-source-comparison"
                    class="source-comparison-panel"
                    aria-live="polite"
                  >
                    <p class="source-comparison-empty">
                      Noch keine Vergleichsdaten geladen.
                    </p>
                  </div>
                </div>
              </section>

              <section
                class="settings-subview"
                data-view="docs"
                aria-hidden="true"
              >
                <header class="settings-subview-header">
                  <button
                    class="settings-back-btn"
                    type="button"
                    data-settings-back
                  >
                    ←
                  </button>
                  <div>
                    <p class="eyebrow">Richtlinien</p>
                    <h3>Technische Dokumentation</h3>
                  </div>
                </header>
                <div class="settings-subview-body doc-links">
                  <a href="../legal/privacy.html" target="_blank"
                    >Datenschutz</a
                  >
                  <a href="../legal/terms.html" target="_blank"
                    >Nutzungsbedingungen</a
                  >
                  <a href="../docs/architecture/overview.md" target="_blank"
                    >Architektur</a
                  >
                  <a href="../docs/status/TESTING_STATUS.md" target="_blank"
                    >Testing</a
                  >
                  <a
                    href="../docs/status/REQUIREMENTS_VALIDATION.md"
                    target="_blank"
                    >Compliance</a
                  >
                </div>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="toast-container"
      class="toast-stack"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <div
      id="day-detail-modal"
      class="day-detail-modal"
      aria-hidden="true"
      role="dialog"
      aria-label="Tagesdetails"
    ></div>
    <div id="modal-overlay" class="modal-overlay" role="presentation"></div>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("service-worker.js")
          .then((reg) => {
            console.log("✅ Service Worker registriert:", reg);
            // Force update check
            reg.update();
          })
          .catch((err) => {
            console.warn("⚠️ Service Worker Registrierung fehlgeschlagen:", err);
          });
      }
    </script>

    <script src="vendor/leaflet/leaflet.js"></script>
    <script>
      if (typeof window !== "undefined" && typeof window.L === "undefined") {
        const fallbackLeaflet = document.createElement("script");
        fallbackLeaflet.src = "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js";
        fallbackLeaflet.integrity =
          "sha256-pNt9A+T5Avzk1l3pNGdisz8Iky3Uczdlz7YTl25sjEo=";
        fallbackLeaflet.crossOrigin = "";
        document.body.appendChild(fallbackLeaflet);
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"
      crossorigin="anonymous"
    ></script>

    <script src="utils/constants.js"></script>
    <script src="utils/iconMapper.js"></script>
    <script src="utils/cache.js"></script>
    <script src="utils/validation.js"></script>
    <script src="utils/healthSafetyEngine.js"></script>
    <script src="utils/apiKeyManager.js"></script>
    <script src="api/weather.js"></script>
    <script src="api/brightsky.js"></script>
    <script src="api/openweathermap.js"></script>
    <script src="api/visualcrossing.js"></script>
    <script src="api/meteostat.js"></script>
    <script src="api/bigdatacloud.js"></script>
    <script src="api/sunriseSunset.js"></script>
    <script src="api/moonPhase.js"></script>
    <script src="ui/errorHandler.js"></script>
    <script src="ui/components/MetricCard.js"></script>
    <script src="ui/home/WeatherHero.js"></script>
    <script src="ui/home/HomeCards.js"></script>
    <script src="ui/home/WeatherCards.js"></script>
    <script src="ui/home/FrogHeroPlayer.js"></script>
    <script src="ui/searchInput.js"></script>
    <script src="ui/dayDetailTemplate.js"></script>
    <script src="ui/weatherDisplay.js"></script>
    <script src="ui/modals/ModalController.js"></script>
    <script src="ui/modals/LocationPickerController.js"></script>
    <script src="ui/health/HealthSafetyView.js"></script>
    <script src="ui/history/HistoryViewBrowser.js"></script>
    <script src="ui/settings/SettingsHome.js"></script>
    <script src="ui/settings/BackgroundSettingsSheet.js"></script>
    <script src="ui/shared/BottomNav.js"></script>
    <script src="features.js"></script>
    <script src="app.js"></script>
  </body>
</html>
